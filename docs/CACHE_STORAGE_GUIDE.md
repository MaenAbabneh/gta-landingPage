# Cache Storage API Integration

## โ ุชู ุฅุถุงูุฉ Cache Storage API ุจูุฌุงุญ

### ุงููููุงุช ุงููุถุงูุฉ/ุงููุนุฏูุฉ:

#### 1. `lib/cacheManager.js` (ุฌุฏูุฏ)

ูุฏูุฑ ูุชูุงูู ูู Cache Storage ูุน:

- โ ุชุฎุฒูู ูุงุณุชุฑุฌุงุน ุงูุฃุตูู (ููุฏูููุงุช + ุตูุฑ)
- โ ุฅุฏุงุฑุฉ ุงูุญุตุต (Quota Management): ุญุฏ ุฃูุตู 500MB
- โ ูุญุต ุงููุณุงุญุฉ ุงููุชุงุญุฉ ูุจู ุงูุชุฎุฒูู
- โ ุชูุธูู ุงูุฅุตุฏุงุฑุงุช ุงููุฏููุฉ ุชููุงุฆูุงู
- โ ุฅุญุตุงุฆูุงุช ุงููุงุด (ุนุฏุฏ ุงูุฃุตููุ ุงูุงุณุชุฎุฏุงูุ ุงููุณุจุฉ)

#### 2. `hooks/useAssetPrecacher.js` (ูุญุฏูุซ)

- โ ูุฎุฒู ุงูุตูุฑ ูุงูููุฏูููุงุช ูู Cache Storage ุฃููุงู
- โ Fallback ุฅูู prefetch ุงูุชูููุฏู ุฅุฐุง ูุดู

#### 3. `hooks/useLazyVideo.js` (ูุญุฏูุซ)

- โ ูุชุญูู ูู Cache Storage ูุจู ุชุญููู ูู ุงูุดุจูุฉ
- โ ููุดุฆ Object URL ูู ุงููุงุด (ุฃุณุฑุน)
- โ ูุฎุฒู ุชููุงุฆูุงู ูู ุงูุฎูููุฉ ุนูุฏ ุงูุชุญููู ุงูุฃูู

#### 4. `hooks/useLazyImage.js` (ูุญุฏูุซ)

- โ ูุชุญูู ูู Cache Storage ูุจู ุชุญููู ูู ุงูุดุจูุฉ
- โ ููุดุฆ Object URL ูู ุงููุงุด
- โ ูุฎุฒู ุชููุงุฆูุงู ูู ุงูุฎูููุฉ ุนูุฏ ุงูุชุญููู ุงูุฃูู

#### 5. `components/precacher.js` (ูุญุฏูุซ)

- โ ููุธู ุงูุฅุตุฏุงุฑุงุช ุงููุฏููุฉ ุนูุฏ ุจุฏุก ุงูุชุทุจูู
- โ ูุทุจุน ุฅุญุตุงุฆูุงุช ุงููุงุด ูู Console

---

## ููููุฉ ุงูุชุญูู ูู ุนูู Cache Storage:

### ูู ุงููุชุตูุญ (Chrome/Edge):

1. ุงูุชุญ DevTools (F12)
2. ุงุฐูุจ ุฅูู **Application** tab
3. ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ โ **Cache** โ **Cache Storage**
4. ุณุชุฌุฏ: `gta-assets-v1`
5. ุงูุชุญูุง ูุชุฑู ุฌููุน ุงูููุฏูููุงุช ูุงูุตูุฑ ุงููุฎุฒูุฉ

### ูู Console:

ุณุชุธูุฑ ุฑุณุงูุฉ ุนูุฏ ุชุญููู ุงูุตูุญุฉ:

```
๐ฆ Cache Storage: {
  assets: 15,
  usage: "45.23 MB",
  quota: "250.00 MB",
  percentage: "18.1%"
}
```

---

## API ุงููุชุงุญุฉ ููุงุณุชุฎุฏุงู:

### ุชุฎุฒูู ูุฏูู:

\`\`\`javascript
import { cacheAsset } from '@/lib/cacheManager';

// ุชุฎุฒูู ููุฏูู ุฃู ุตูุฑุฉ
await cacheAsset('https://example.com/video.mp4');
\`\`\`

### ุงูุชุญูู ูู ุงููุงุด:

\`\`\`javascript
import { isCached, getCachedAsset } from '@/lib/cacheManager';

// ูู ูุฎุฒููุ
const cached = await isCached(url);

// ุงุณุชุฑุฌุงุน ูู ุงููุงุด
const response = await getCachedAsset(url);
const blob = await response.blob();
\`\`\`

### ูุณุญ ุงููุงุด:

\`\`\`javascript
import { clearAllCache, deleteCachedAsset } from '@/lib/cacheManager';

// ูุณุญ ูู ุดูุก
await clearAllCache();

// ูุณุญ ููู ูุงุญุฏ
await deleteCachedAsset(url);
\`\`\`

### ุฅุญุตุงุฆูุงุช:

\`\`\`javascript
import { getCacheStats, getStorageInfo } from '@/lib/cacheManager';

const stats = await getCacheStats();
console.log(stats.totalAssets, stats.storage);
\`\`\`

---

## ุงูุญุฏูุฏ ูุงููููุฏ:

| ุงูุฅุนุฏุงุฏ          | ุงููููุฉ                     |
| ---------------- | -------------------------- |
| **ุงูุญุฏ ุงูุฃูุตู**  | 500 MB                     |
| **ูุณุจุฉ ุงูุชุญุฐูุฑ** | 80% ูู ุงููุณุงุญุฉ ุงููุชุงุญุฉ     |
| **ุฅุตุฏุงุฑ ุงููุงุด**  | v1 (ููุญุฏูุซ ูุฏููุงู)         |
| **TTL**          | ุบูุฑ ูุญุฏูุฏ (ูุจูู ุญุชู ูููุณุญ) |

---

## ุงููุฒุงูุง:

โ **Offline-first**: ุชุนูู ุงูุฃุตูู ุจุฏูู ุฅูุชุฑูุช ุจุนุฏ ุงูุชุฎุฒูู  
โ **ุฃุณุฑุน**: Object URLs ูู ุงููุงุด ุฃุณุฑุน ูู ุงูุดุจูุฉ  
โ **ุฐูู**: ูุชุญูู ูู ุงููุณุงุญุฉ ูุจู ุงูุชุฎุฒูู  
โ **ุชููุงุฆู**: ูุฎุฒู ุงูุฃุตูู ูู ุงูุฎูููุฉ ุจุฏูู blocking  
โ **ุขูู**: Fallback ุฅูู HTTP Cache ุฅุฐุง ูุดู

---

## ุงูุงุฎุชุจุงุฑ:

1. ุดุบูู `npm run dev`
2. ุงูุชุญ ุงูุตูุญุฉ ูู Chrome
3. ุงูุชุญ DevTools โ Application โ Cache Storage
4. ุงุณูุฑูู ุฎูุงู ุงูุตูุญุฉ (ุณุชูุฎุฒู ุงูุฃุตูู ุชุฏุฑูุฌูุงู)
5. ุฃุนุฏ ุชุญููู ุงูุตูุญุฉ โ ุณุชูุญููู ูู ุงููุงุด (ุฃุณุฑุน ุจูุซูุฑ)
6. ุฌุฑูุจ offline mode (DevTools โ Network โ Offline)

---

## ููุงุญุธุงุช:

- ุงููุงุด ูุนูู ููุท ุนูู **HTTPS** (ุฃู localhost)
- ูู ูุชุตูุญ ูู ุญุตุฉ ูุฎุชููุฉ (ุนุงุฏุฉ 10-50% ูู ูุณุงุญุฉ ุงููุฑุต ุงููุชุงุญุฉ)
- Safari ูู ูููุฏ ุฃูุซุฑ ุตุฑุงูุฉ ุนูู Cache Storage
- ูููู ุฑูุน ุงูุฅุตุฏุงุฑ (`CACHE_VERSION`) ูุฅุฌุจุงุฑ ุงููุณุชุฎุฏููู ุนูู ุชุญุฏูุซ ุงููุงุด
